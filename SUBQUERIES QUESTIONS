1ï¸âƒ£ IN Subquery
â“ Question

Find the film_id and title of films that were rented on 2005-05-29.

âœ… Answer
SELECT DISTINCT f.film_id, f.title
FROM film f
JOIN inventory i
  ON f.film_id = i.film_id
WHERE i.inventory_id IN (
    SELECT r.inventory_id
    FROM rental r
    WHERE DATE(r.rental_date) = '2005-05-29'
)
ORDER BY f.film_id;

ðŸ”Ž Concept Used

Subquery in WHERE

IN for list comparison

Handling TIMESTAMP vs DATE

2ï¸âƒ£ Simple EXISTS
â“ Question

List customers who have made at least one payment.

âœ… Answer
SELECT c.first_name, c.last_name
FROM customer c
WHERE EXISTS (
    SELECT 1
    FROM payment p
    WHERE p.customer_id = c.customer_id
);

ðŸ”Ž Concept Used

EXISTS for existence check

Correlation using customer_id

3ï¸âƒ£ Correlated EXISTS
â“ Question

Find customers who have made a payment greater than 10.

âœ… Answer
SELECT c.first_name, c.last_name
FROM customer c
WHERE EXISTS (
    SELECT 1
    FROM payment p
    WHERE p.customer_id = c.customer_id
      AND p.amount > 10
);

ðŸ”Ž Concept Used

Correlated subquery

Conditional existence check

4ï¸âƒ£ Subquery with Aggregate (Non-Correlated)
â“ Question

Find all payments that are greater than the average payment amount.

âœ… Answer
SELECT *
FROM payment
WHERE amount > (
    SELECT AVG(amount)
    FROM payment
);

ðŸ”Ž Concept Used

Aggregate function inside subquery

Non-correlated subquery

Scalar comparison

5ï¸âƒ£ Subquery in SELECT Clause
â“ Question

Show each customerâ€™s first name, last name, and total number of payments made.

âœ… Answer
SELECT
    c.first_name,
    c.last_name,
    (
        SELECT COUNT(*)
        FROM payment p
        WHERE p.customer_id = c.customer_id
    ) AS total_payments
FROM customer c;

ðŸ”Ž Concept Used

Subquery in SELECT clause

Correlated subquery

One value returned per outer 



-- 6ï¸âƒ£ Subquery in FROM Clause (Derived Table)
-- Find customers whose average payment amount is greater than 5.

FIRST WAY 

-- SELECT c.first_name, c.last_name
-- FROM customer c
-- JOIN (
--     SELECT customer_id, AVG(amount) AS avg_amount
--     FROM payment
--     GROUP BY customer_id
-- ) p
--   ON c.customer_id = p.customer_id
-- WHERE p.avg_amount > 5;


SECOND WAY 

SELECT c.first_name, c.last_name
FROM customer AS c
WHERE (
    SELECT AVG(p.amount)
    FROM payment AS p
    WHERE c.customer_id = p.customer_id
) > 5;

